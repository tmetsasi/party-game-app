{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import Button from\"react-native-web/dist/exports/Button\";import View from\"react-native-web/dist/exports/View\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Text from\"react-native-web/dist/exports/Text\";import React from'react';import AppStyles from\"../styles/AppStyles\";import{auth,db}from\"../firebase\";import{collection,query,where,getDocs,writeBatch}from\"firebase/firestore\";import{signOut,updatePassword,signInWithEmailAndPassword,deleteUser}from'firebase/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ManageAccount(_ref){var navigation=_ref.navigation;var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),newPassword=_React$useState2[0],setNewPassword=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),currentPassword=_React$useState4[0],setCurrentPassword=_React$useState4[1];var _React$useState5=React.useState(\"\"),_React$useState6=_slicedToArray(_React$useState5,2),errorMessage=_React$useState6[0],setErrorMessage=_React$useState6[1];var logout=function logout(){signOut(auth).then(function(){navigation.popToTop();});};var updateUserPassword=function updateUserPassword(){signInWithEmailAndPassword(auth,auth.currentUser.email,currentPassword).then(function(userCredential){var user=userCredential.user;updatePassword(user,newPassword).then(function(){setNewPassword(\"\");setErrorMessage(\"\");setCurrentPassword(\"\");}).catch(function(error){setErrorMessage(error.message);});}).catch(function(error){setErrorMessage(error.message);});};var deleteUserAndToDos=function deleteUserAndToDos(){if(currentPassword===\"\"){setErrorMessage(\"Must enter current password to delete account\");}else{signInWithEmailAndPassword(auth,auth.currentUser.email,currentPassword).then(function(userCredential){var user=userCredential.user;var batch=writeBatch(db);var q=query(collection(db,\"todos\"),where(\"userId\",\"==\",user.uid));getDocs(q).then(function(querySnapshot){querySnapshot.forEach(function(doc){batch.delete(doc.ref);});batch.commit();deleteUser(user).then(function(){navigation.popToTop();}).catch(function(error){setErrorMessage(error.message);});});}).catch(function(error){setErrorMessage(error.message);});}};return _jsxs(View,{style:AppStyles.container,children:[_jsx(Text,{style:AppStyles.errorText,children:errorMessage}),_jsx(TextInput,{style:[AppStyles.textInput,AppStyles.darkTextInput],placeholder:\"Nykyinen salasana\",value:currentPassword,secureTextEntry:true,onChangeText:setCurrentPassword}),_jsx(TextInput,{style:[AppStyles.textInput,AppStyles.darkTextInput],placeholder:\"Uusi salasana\",value:newPassword,secureTextEntry:true,onChangeText:setNewPassword}),_jsx(Button,{title:\"P\\xE4ivit\\xE4 salasana\",onPress:updateUserPassword}),_jsx(Button,{title:\"Poista k\\xE4ytt\\xE4j\\xE4tili\",onPress:deleteUserAndToDos}),_jsx(Button,{title:\"Kirjaudu ulos\",onPress:logout}),_jsx(Button,{title:\"Takaisin valikkoon\",onPress:function onPress(){return navigation.pop();}})]});}","map":{"version":3,"names":["React","AppStyles","auth","db","collection","query","where","getDocs","writeBatch","signOut","updatePassword","signInWithEmailAndPassword","deleteUser","ManageAccount","navigation","useState","newPassword","setNewPassword","currentPassword","setCurrentPassword","errorMessage","setErrorMessage","logout","then","popToTop","updateUserPassword","currentUser","email","userCredential","user","catch","error","message","deleteUserAndToDos","batch","q","uid","querySnapshot","forEach","doc","delete","ref","commit","container","errorText","textInput","darkTextInput","pop"],"sources":["/Users/tmetsasi/Desktop/Projects/PartyGame/party-game-app/screens/ManageAccount.js"],"sourcesContent":["import { Button, View, TextInput, Text } from 'react-native';\nimport React from 'react';\nimport AppStyles from '../styles/AppStyles';\nimport { auth, db } from \"../firebase\";\nimport { collection, query, where, getDocs, writeBatch } from \"firebase/firestore\"; \nimport { signOut, updatePassword, signInWithEmailAndPassword, deleteUser } from 'firebase/auth';\n\nexport default function ManageAccount({ navigation }) {\n  let [newPassword, setNewPassword] = React.useState(\"\");\n  let [currentPassword, setCurrentPassword] = React.useState(\"\");\n  let [errorMessage, setErrorMessage] = React.useState(\"\");\n  let logout = () => {\n    signOut(auth).then(() => {\n      navigation.popToTop();\n    });\n  }\n\n  let updateUserPassword = () => {\n    signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\n      .then((userCredential) => {\n        const user = userCredential.user;\n        updatePassword(user, newPassword).then(() => {\n          setNewPassword(\"\");\n          setErrorMessage(\"\");\n          setCurrentPassword(\"\");\n        }).catch((error) => {\n          setErrorMessage(error.message);\n        });\n      })\n      .catch((error) => {\n        setErrorMessage(error.message);\n      });\n  };\n\n  let deleteUserAndToDos = () => {\n    if (currentPassword === \"\") {\n      setErrorMessage(\"Must enter current password to delete account\");\n    } else {\n      signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\n      .then((userCredential) => {\n        const user = userCredential.user;\n\n        // Get all todos for user and delete\n        let batch = writeBatch(db);\n        const q = query(collection(db, \"todos\"), where(\"userId\", \"==\", user.uid));\n        getDocs(q).then((querySnapshot) => {\n          querySnapshot.forEach((doc) => {\n            batch.delete(doc.ref);\n          });\n          batch.commit();\n  \n          deleteUser(user).then(() => {\n            navigation.popToTop();\n          }).catch((error) => {\n            setErrorMessage(error.message);\n          });\n        });\n      })\n      .catch((error) => {\n        setErrorMessage(error.message);\n      });\n    }\n  };\n\n  return (\n    <View style={AppStyles.container}>\n      <Text style={AppStyles.errorText}>{errorMessage}</Text>\n      <TextInput \n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \n          placeholder='Nykyinen salasana'\n          value={currentPassword}\n          secureTextEntry={true}\n          onChangeText={setCurrentPassword} />\n      <TextInput \n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \n          placeholder='Uusi salasana'\n          value={newPassword}\n          secureTextEntry={true}\n          onChangeText={setNewPassword} />\n      <Button title=\"Päivitä salasana\" onPress={updateUserPassword} />\n      <Button title=\"Poista käyttäjätili\" onPress={deleteUserAndToDos} />\n      <Button title=\"Kirjaudu ulos\" onPress={logout} />\n      <Button title=\"Takaisin valikkoon\" onPress={() => navigation.pop()} />\n    </View>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}