{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport React from 'react';\nimport AppStyles from \"../styles/AppStyles\";\nimport { auth, db } from \"../firebase\";\nimport { collection, query, where, getDocs, writeBatch } from \"firebase/firestore\";\nimport { signOut, updatePassword, signInWithEmailAndPassword, deleteUser } from 'firebase/auth';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function ManageAccount(_ref) {\n  var navigation = _ref.navigation;\n  var _React$useState = React.useState(\"\"),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    newPassword = _React$useState2[0],\n    setNewPassword = _React$useState2[1];\n  var _React$useState3 = React.useState(\"\"),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    currentPassword = _React$useState4[0],\n    setCurrentPassword = _React$useState4[1];\n  var _React$useState5 = React.useState(\"\"),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    errorMessage = _React$useState6[0],\n    setErrorMessage = _React$useState6[1];\n  var logout = function logout() {\n    signOut(auth).then(function () {\n      navigation.popToTop();\n    });\n  };\n  var updateUserPassword = function updateUserPassword() {\n    signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword).then(function (userCredential) {\n      var user = userCredential.user;\n      updatePassword(user, newPassword).then(function () {\n        setNewPassword(\"\");\n        setErrorMessage(\"\");\n        setCurrentPassword(\"\");\n      }).catch(function (error) {\n        setErrorMessage(error.message);\n      });\n    }).catch(function (error) {\n      setErrorMessage(error.message);\n    });\n  };\n  var deleteUserAndToDos = function deleteUserAndToDos() {\n    if (currentPassword === \"\") {\n      setErrorMessage(\"Must enter current password to delete account\");\n    } else {\n      signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword).then(function (userCredential) {\n        var user = userCredential.user;\n        var batch = writeBatch(db);\n        var q = query(collection(db, \"todos\"), where(\"userId\", \"==\", user.uid));\n        getDocs(q).then(function (querySnapshot) {\n          querySnapshot.forEach(function (doc) {\n            batch.delete(doc.ref);\n          });\n          batch.commit();\n          deleteUser(user).then(function () {\n            navigation.popToTop();\n          }).catch(function (error) {\n            setErrorMessage(error.message);\n          });\n        });\n      }).catch(function (error) {\n        setErrorMessage(error.message);\n      });\n    }\n  };\n  return _jsxs(View, {\n    style: AppStyles.container,\n    children: [_jsx(Text, {\n      style: AppStyles.errorText,\n      children: errorMessage\n    }), _jsx(TextInput, {\n      style: [AppStyles.textInput, AppStyles.darkTextInput],\n      placeholder: \"Nykyinen salasana\",\n      value: currentPassword,\n      secureTextEntry: true,\n      onChangeText: setCurrentPassword\n    }), _jsx(TextInput, {\n      style: [AppStyles.textInput, AppStyles.darkTextInput],\n      placeholder: \"Uusi salasana\",\n      value: newPassword,\n      secureTextEntry: true,\n      onChangeText: setNewPassword\n    }), _jsx(Button, {\n      title: \"P\\xE4ivit\\xE4 salasana\",\n      onPress: updateUserPassword\n    }), _jsx(Button, {\n      title: \"Poista k\\xE4ytt\\xE4j\\xE4tili\",\n      onPress: deleteUserAndToDos\n    }), _jsx(Button, {\n      title: \"Kirjaudu ulos\",\n      onPress: logout\n    }), _jsx(Button, {\n      title: \"Takaisin valikkoon\",\n      onPress: function onPress() {\n        return navigation.pop();\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","AppStyles","auth","db","collection","query","where","getDocs","writeBatch","signOut","updatePassword","signInWithEmailAndPassword","deleteUser","ManageAccount","navigation","useState","newPassword","setNewPassword","currentPassword","setCurrentPassword","errorMessage","setErrorMessage","logout","then","popToTop","updateUserPassword","currentUser","email","userCredential","user","catch","error","message","deleteUserAndToDos","batch","q","uid","querySnapshot","forEach","doc","delete","ref","commit","container","errorText","textInput","darkTextInput","pop"],"sources":["/Users/tmetsasi/Desktop/Projects/PartyGame/party-game-app/screens/ManageAccount.tsx"],"sourcesContent":["import { Button, View, TextInput, Text } from 'react-native';\nimport React from 'react';\nimport AppStyles from '../styles/AppStyles';\nimport { auth, db } from \"../firebase\";\nimport { collection, query, where, getDocs, writeBatch } from \"firebase/firestore\"; \nimport { signOut, updatePassword, signInWithEmailAndPassword, deleteUser } from 'firebase/auth';\n\nexport default function ManageAccount({ navigation }) {\n  let [newPassword, setNewPassword] = React.useState(\"\");\n  let [currentPassword, setCurrentPassword] = React.useState(\"\");\n  let [errorMessage, setErrorMessage] = React.useState(\"\");\n  let logout = () => {\n    signOut(auth).then(() => {\n      navigation.popToTop();\n    });\n  }\n\n  let updateUserPassword = () => {\n    signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\n      .then((userCredential) => {\n        const user = userCredential.user;\n        updatePassword(user, newPassword).then(() => {\n          setNewPassword(\"\");\n          setErrorMessage(\"\");\n          setCurrentPassword(\"\");\n        }).catch((error) => {\n          setErrorMessage(error.message);\n        });\n      })\n      .catch((error) => {\n        setErrorMessage(error.message);\n      });\n  };\n\n  let deleteUserAndToDos = () => {\n    if (currentPassword === \"\") {\n      setErrorMessage(\"Must enter current password to delete account\");\n    } else {\n      signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\n      .then((userCredential) => {\n        const user = userCredential.user;\n\n        // Get all todos for user and delete\n        let batch = writeBatch(db);\n        const q = query(collection(db, \"todos\"), where(\"userId\", \"==\", user.uid));\n        getDocs(q).then((querySnapshot) => {\n          querySnapshot.forEach((doc) => {\n            batch.delete(doc.ref);\n          });\n          batch.commit();\n  \n          deleteUser(user).then(() => {\n            navigation.popToTop();\n          }).catch((error) => {\n            setErrorMessage(error.message);\n          });\n        });\n      })\n      .catch((error) => {\n        setErrorMessage(error.message);\n      });\n    }\n  };\n\n  return (\n    <View style={AppStyles.container}>\n      <Text style={AppStyles.errorText}>{errorMessage}</Text>\n      <TextInput \n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \n          placeholder='Nykyinen salasana'\n          value={currentPassword}\n          secureTextEntry={true}\n          onChangeText={setCurrentPassword} />\n      <TextInput \n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \n          placeholder='Uusi salasana'\n          value={newPassword}\n          secureTextEntry={true}\n          onChangeText={setNewPassword} />\n      <Button title=\"Päivitä salasana\" onPress={updateUserPassword} />\n      <Button title=\"Poista käyttäjätili\" onPress={deleteUserAndToDos} />\n      <Button title=\"Kirjaudu ulos\" onPress={logout} />\n      <Button title=\"Takaisin valikkoon\" onPress={() => navigation.pop()} />\n    </View>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}